ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  sporttery:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: This is sporttery service
      Role: 'ROLE_ARN_XXXXX'
      VpcConfig:
        VpcId: VPC_ID_XXXXX
        VSwitchIds:
          - V_SWITCH_ID_XXXXX
        SecurityGroupId: SECURITY_GROUP_ID_XXXXX
      InternetAccess: true
    crawler:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: index.handler
        Runtime: python3
        Timeout: 60
        MemorySize: 512
        CodeUri: functions/crawler
        EnvironmentVariables:
          ALIYUN_AK: ALIYUN_AK_XXXXX
          ALIYUN_SK: ALIYUN_SK_XXXXX
      Events:
        TmTrigger:
          Type: Timer
          Properties: 
            CronExpression: "0 0/5 * * * *"  # 每隔 5 分钟抓取赛事数据
            Enable: true
    apiMatchGetFootball:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: index.handler
        Runtime: python3
        Timeout: 60
        MemorySize: 512
        CodeUri: functions/apiMatchGetFootball
        EnvironmentVariables:
          ALIYUN_AK: ALIYUN_AK_XXXXX
          ALIYUN_SK: ALIYUN_SK_XXXXX
      Events:
        httpTrigger:
          Type: HTTP
          Properties:
            AuthType: ANONYMOUS
            Methods:
              - GET
              - POST
    timeCrawler:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Handler: index.handler
        Runtime: python3
        Timeout: 60
        MemorySize: 512
        CodeUri: functions/timeCrawler
        EnvironmentVariables:
          ALIYUN_AK: ALIYUN_AK_XXXXX
          ALIYUN_SK: ALIYUN_SK_XXXXX
      Events:
        TmTrigger:
          Type: Timer
          Properties: 
            CronExpression: "0 10 0 * * *"  # 每天早上 8:10 抓取当天的售卖时间
            Enable: true